<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>NFT Minting</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
    <script src="https://cdn.ethers.io/lib/ethers-5.0.umd.min.js" type="text/javascript"></script>
    <style>
      html,body{
        height:100%;
        margin:0;
      }

      .wrapper{
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 10px;
        grid-auto-rows: minmax(100px, auto);
        height:90%;
      }

      .divider {
        display:grid;
        grid-column: 1 / 3;
        grid-row: 1;
        align-items: end;
      }
      .tokenURI {
        grid-column: 1/3;
        grid-row: 2 / 5;
      }
      .meta-container{
        display:grid;
        margin: 0 auto;
        justify-items:center;
        margin-top:30px;
        border:solid;
        width:80%;
        padding: 25px;
        border-radius: 50px;
      }
      .meta-container img{
        width:70%;
        height:auto;
        border-radius: 50px;
      }

      .transaction_form {
        grid-column: 3 / 5;
        grid-row: 1 / 5;
        display:flex;
        align-items:center;
      }

      .selection{
        width:90%;
        background-color: gray;
        margin:0 auto;
        height:20%;
        border-radius: 15px;
        margin-top:20px;
        display:flex;
        align-items:center;
      }

      .selection img{
        width: 15%;
        border-radius:15px;
        margin-left: 25px;
      }

      .mint-info{
        color:black;
        width: 90%;
        margin: 0 auto;
        margin-top:15px;
        padding:40px;
        border-radius:25px;
        font-size:20px;
      }

      .mint-button{
        margin: 0 auto;
        width:80%;
        height:15%;
        border:solid;
        background-color:green;
        display:flex;
        justify-content: center;
        align-items: center;
        color:white;
        border-radius: 10px;
        font-size:2rem;
        cursor:pointer;
        margin-top:15px;
      }

    </style>
  </head>
  <body>
    <div style = "background-color:orange;width:100%;height:10%;justify-content: center;display:flex;align-items:center" class = "navbar">Navbar</div>
    <div class="wrapper">
      <div class="divider">
        <div id = "status" style = "text-align:center;font-size:35px;">Welcome to UNCC Mascot NFT Site</div>
        <div style = "width:100%;background-color:green;height:15%;"></div>
      </div>
      <div class="tokenURI">
        <div class = "meta-container">
          <img src = "./images/unccniner.png" />
          <p style = "font-weight: bold;">University of North Carolina Mascot Niner</p>
          <p>#3225</p>
        </div>
      </div>
      <div class="transaction_form">
        <div style = "width:80%;height:85%; margin:0 auto;border:solid;border-radius:15px;">
          <h1 style = "text-align:center;text-decoration:underline;">Mint Checkout</h1>
          <div class = "selection">
            <img src = "./images/unccniner.png" />
            <div style = "color: white;font-weight: 500;margin-left: 25px;">
              <div>#3225</div>
              <div>UNCC Mascot</div>
            </div>
            <div>
              <input style = "height:50%;font-size:35px;border-radius:5px;" type="number" id="quantity" name="quantity" min="1" max="5">
            </div>
          </div>
          <div class = "mint-info">
            <div style = "margin-bottom:10px;">Mint fee: 1%</div>
            <div>Price: 0.05 ETH Per Token</div>
          </div>
          <div onClick = "mint()"class = "mint-button">MINT</div>
        </div>
      </div>
    </div>
  </body>
  <script>
    const mint = async() =>{
      //set up the important tools
      const { ethereum } = window;
      var provider = new ethers.providers.Web3Provider(window.ethereum);
      var signer = provider.getSigner();
      //get the account information
      const accounts = await ethereum.request({method: 'eth_accounts'});
      const balance = ethers.utils.formatEther(await provider.getBalance(accounts[0]));
      //import and parse the json that contains the function of the smart contract
      let contract;
      const res = await fetch('./contracts/NewMintNet.json')
      contract = await res.json();
      //information of the contract
      const contractAddress = "0xb15275bE4573AFB78f084b97682BB68dd33084d6";
      const abi = contract.abi;
      //console.log(abi)

      //create the instance of smart contract
      const nftContract = new ethers.Contract(contractAddress, abi, signer);

      test_set = "0xa8771787a37566246706f0e0eabe54f922f2dbb67ff2d20911fe95bcb93a72ad";
      /*Calls the mint function in the smart contract*/
      const price = 0.05
      try{
        if(balance >= price){ //checks to make sure balance of the account is greater than the price
          let nftTxn = await nftContract.mint({ value: ethers.utils.parseEther(price.toString()) });
          console.log("Mining... please wait");
          await nftTxn.wait();
          console.log(`${nftTxn.hash}`);
          window.open(`https://rinkeby.etherscan.io/tx/${nftTxn.hash}`, '_blank').focus();
        }
      }catch(error){
        let obj = document.getElementById('status');
        obj.innerHTML = error.data.message.toUpperCase();
        obj.style.backgroundColor = "tomato";
        console.log(error.data.message);
      }
    }
  </script>
</html>
